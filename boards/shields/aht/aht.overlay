/*
 * 10-key numpad shield
 * MCU: nice!nano v2 (Pro Micro footprint compatible)
 */

#include <dt-bindings/zmk/matrix_transform.h>
#include <physical_layouts.dtsi>

/ {
	
	chosen {
		zmk,kscan = &kscan0;
		zmk,physical-layout = &physical_layout0;
	};

	default_transform: matrix_transform {
		compatible = "zmk,matrix-transform";
		columns = <4>;
        rows = <3>;
		map = <
			RC(0,0) RC(0,1) RC(0,2)
			RC(1,0) RC(1,1) RC(1,2)
			RC(2,0) RC(2,1) RC(2,2) RC(2,3)
		>;
	};

	physical_layout0: physical_layout0 {
		compatible = "zmk,physical-layout";
		display-name = "10-Key Layout";
		transform = <&default_transform>;
        kscan = <&kscan0>;
		keys 
            = <&key_physical_attrs 100 100   0   0  0 0 0>
			, <&key_physical_attrs 100 100 100   0  0 0 1>
			, <&key_physical_attrs 100 100 200   0  0 0 2>
			, <&key_physical_attrs 100 100   0 100  0 1 0>
			, <&key_physical_attrs 100 100 100 100  0 1 1>
			, <&key_physical_attrs 100 100 200 100  0 1 2>
			, <&key_physical_attrs 100 100   0 200  0 2 0>
			, <&key_physical_attrs 100 100 100 200  0 2 1>
			, <&key_physical_attrs 100 100 200 200  0 2 2>
			, <&key_physical_attrs 100 100 300 200  0 2 3>
		    ;
	};

	kscan0: kscan {
		compatible = "zmk,kscan-gpio-matrix";
		diode-direction = "col2row";
		debounce-press-ms = <5>;
		debounce-release-ms = <5>;

		row-gpios = <&gpio1 0 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>,
		            <&gpio1 6 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>,
		            <&gpio0 9 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>;

		col-gpios = <&gpio0 2 GPIO_ACTIVE_HIGH>,
		            <&gpio1 13 GPIO_ACTIVE_HIGH>,
		            <&gpio1 4 GPIO_ACTIVE_HIGH>,
		            <&gpio0 10 GPIO_ACTIVE_HIGH>;
	};
};
